---
title: "shinny"
output: html_document
date: "2024-04-11"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(shinydashboard)
library(shiny)
library(DT)
library(highcharter)
library(quantmod)
library(scales)
library(ggplot2)
source('helper_funcs.R')
library(tidyverse)
ui <- dashboardPage(
  dashboardHeader(
    title=div(img(src="https://vinuni.ap.panopto.com/Panopto/ContentCache/637196699518830531/_branding/6f870251-830c-4808-9e77-ab7d004564ea/637196697191200399_embedlogo.png", height = '50', width ='50'), "Data Visualization"),
dropdownMenuOutput("messageMenu")
  ),
  dashboardSidebar(
    sidebarMenu(
      menuItem("Dashboard", tabName = "dashboard", icon = icon("dashboard")),
      menuItem("DetailBoard", tabName = "detail", icon = icon("th"), badgeLabel = "developing", badgeColor = "green")
    )
  ),
  skin = "black",
  dashboardBody(
    tabItems(
      # First tab content
      tabItem(tabName = "dashboard",
        h2(paste0("Market Watch")),
        fluidRow(
          valueBoxOutput("m1") ,
          valueBoxOutput("m2") ,
          valueBoxOutput("m3")
          ),
        h2(paste0("Spotlight")),
        fluidRow(
          valueBoxOutput("up1", width = 2),
          valueBoxOutput("up2", width = 2),
          valueBoxOutput("up3", width = 2),
          valueBoxOutput("ExGBox", width = 2) ,
          valueBoxOutput("ImGBox", width = 2) ,
          valueBoxOutput("BlGBox", width = 2)
          ),
        fluidRow(
          column(highchartOutput("plotd"), width = 4),
          column(highchartOutput("plot1"), width = 4),
          column(
              tabsetPanel(
                id = 'dataset',
                tabPanel("increase", DT::dataTableOutput("mytable1")),
                tabPanel("decrease", DT::dataTableOutput("mytable2")),
                tabPanel("volume", DT::dataTableOutput("mytable3"))
              )
          , width = 4)
        ),
      fluidRow(
        column( width = 8,h4("Stock Pice", align = 'center'), highchartOutput('lineHC') ),
        column(
            checkboxGroupInput("show_vars", "Columns in diamonds to show:",
                           c("VNINDEX", "VN30", "Interest Rate", "User account")),
            width = 4
          ),
      )
      ),

      # Second tab content
      tabItem(tabName = "detail",
        h2("DetailBoard tab content")
      )
    )
  )
)

server <- function(input, output) {
  set.seed(122)
  thislist <- list("apple", "banana", "cherry")
  currentDate <- Sys.Date() 
  output$messageMenu <- renderMenu({
  dropdownMenu(type = "notifications", 
               notificationItem(
               icon = icon("exclamation-triangle"),
               status = "warning", 
               text = paste("data is update at " , currentDate, sep = "",collapse = NULL)
               ))
               
})
dtf <- data.frame(name = c("ETB", "PMA", "PER", "KON", "TRA", 
                  "DDR", "BUM", "MAT", "HED", "EXP"),
                  val = c(.02, .11, -.01, -.03, -.03, .02, .1, -.01, -.02, 0.06), 
                  vol = c(100, 20, 1000, 22, 101, 201, 30, 21, 13, 107),
                  pri = c(10.7, 5.3, 33.4, 19.5, 27.7, 19.3, 103.2, 50.1, 67.2, 84.0))
  output$mytable1 <- DT::renderDataTable({
    DT::datatable(dtf, options = list(dom = 't'))
  })

  # sorted columns are colored now because CSS are attached to them
  output$mytable2 <- DT::renderDataTable({
    DT::datatable(dtf, options = list(dom = 't'))
  })

  # customize the length drop-down menu; display 5 rows per page by default
  output$mytable3 <- DT::renderDataTable({
    DT::datatable(dtf, options = list(dom = 't'))
  })  
  
df <- data.frame(dose=c("D0.5", "D1", "D2"),
                len=c(4.2, 10, 29.5))
x <- getSymbols("GOOG", auto.assign = FALSE)
y <- getSymbols("AMZN", auto.assign = FALSE)

output$lineHC <- renderHighchart({
highchart(type = "stock") |> 
  hc_add_series(x) |> 
  hc_add_series(y, type = "ohlc")
  })

output$m1 <- renderValueBox({
       valueBox(
          "VnIndex",
          paste0("1.2 (", "6.7" ,"%)"),
          icon = icon("arrow-trend-up"), #icon("sign-in"),
          color = "green"
       )
    })

      ###
output$m2 <- renderValueBox({
   valueBox(
      "VN30",
      paste0("2.1 (", "6.0" ,"%)"),
      icon = icon('arrow-trend-up'),# icon("sign-out"),
      color = "green"
   )
})

###
output$m3 <- renderValueBox({
   valueBox(
      "HNX",
      paste0("1.7 (", "6.9" ,"%)"),
      icon = icon("arrow-trend-up"), #icon("sign-in"),
      color = "green"
   )
})

output$up1 <- renderValueBox({
       valueBox(
          "SSI",
          paste0("1.2 (", "6.7" ,"%)"),
          icon = icon("arrow-trend-up"), #icon("sign-in"),
          color = "green"
       )
    })

      ###
output$up2 <- renderValueBox({
   valueBox(
      "ACB",
      paste0("2.1 (", "6.0" ,"%)"),
      icon = icon('arrow-trend-up'),# icon("sign-out"),
      color = "green"
   )
})

###
output$up3 <- renderValueBox({
   valueBox(
      "VND",
      paste0("1.7 (", "6.9" ,"%)"),
      icon = icon("arrow-trend-up"), #icon("sign-in"),
      color = "fuchsia"
   )
})
output$ExGBox <- renderValueBox({
       valueBox(
          "PDR",
          paste0("1.2 (", "6.7" ,"%)"), 
          icon = icon("arrow-trend-down"), #icon("sign-in"),
          color = "red"
       )
    })
      
      ###
output$ImGBox <- renderValueBox({
   valueBox(
      "DIG",
      paste0("2.1 (", "7.0" ,"%)"), 
      icon = icon('arrow-trend-down'),# icon("sign-out"),
      color = "aqua"
   )
})

###
output$BlGBox <- renderValueBox({
   valueBox(
      "NVL",
      paste0("1.7 (", "6.5" ,"%)"), 
      icon = icon("arrow-trend-down"), #icon("sign-in"),
      color = "red"
   )
})
  
dtf <- data.frame(name = c("ETB", "PMA", "PER", "KON", "TRA", 
                  "DDR", "BUM", "MAT", "HED", "EXP"),
                  val = c(.02, .11, -.01, -.03, -.03, .02, .1, -.01, -.02, 0.06), cl = c(0, 0, 1, 1, 1, 0, 0, 1, 1, 0))

output$plotd <- renderHighchart({
#   ggplot(dtf, aes(x, y)) +
#   geom_bar(stat = "identity", aes(fill = x), legend = FALSE) + 
#   scale_y_continuous("Increased Point", labels = percent_format())+
#     ggtitle("Leaders")+
#     theme(
#          panel.background = element_rect(fill='transparent'),
#          plot.background = element_rect(fill='transparent', color=NA),
#          panel.grid.major = element_blank(),
#          panel.grid.minor = element_blank(),
#          plot.title = element_text(hjust=0.5),
#          legend.background = element_rect(fill='transparent'),
#          legend.box.background = element_rect(fill='transparent')
#        )
#     
  hchart(dtf, "column", hcaes(x = name, y = val, group = cl))
  })

  
  output$plot1 <- renderHighchart({
    data <- data.frame(
                  group=c("Resourses", "Bank", "Retail", "Real Estate", "Technology"),
                  value=c(13,7,9,21,2)
                  )

  # Compute the position of labels
    data <- data |>
    arrange(desc(group)) |>
    mutate(prop = value / sum(data$value) *100) |>
    mutate(ypos = cumsum(prop)- 0.5*prop )
  
  # Basic piechart
    # ggplot(data, aes(x="", y=prop, fill=group)) +
    # geom_bar(stat="identity", width=1, color="white") +
    # coord_polar("y", start=0) +
    # theme_void() + 
    # theme(legend.position="none") +
    # 
    # geom_text(aes(y = ypos, label = group), color = "white", size=6) +
    # scale_fill_brewer(palette="Set1")
    hc <- data |>
    hchart("pie", hcaes(x = group, y = prop))|>
    hc_title(text = "Market insight in Industry")
    thm <- hc_theme(
  # apparently a theme does not work without a chart option
  chart = list(backgroundColor = "transparent"),
  plotOptions = 
    list(
      line = 
        list(
          marker = 
            list(
              enabled = TRUE
              )
          )
      )
  )
  hc |> hc_add_theme(thm)
    
    
  })
}
shinyApp(ui, server)
```
